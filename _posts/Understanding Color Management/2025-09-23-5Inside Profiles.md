---
layout: post
title: "第五章 剖析特性文件"
date: 2025-09-24
category: Understanding Color Management
---


**目录**
- [5.1 引言](#51-引言)
- [5.2 ICC特性文件规范](#52-icc特性文件规范)
- [5.3 十六进制特性文件编码](#53-十六进制特性文件编码)
- [5.4 ICC特性文件的结构](#54-icc特性文件的结构)
- [5.5 特性文件头](#55-特性文件头)
  - [5.5.1 首选CMM](#551-首选cmm)
  - [5.5.2 规范版本](#552-规范版本)
  - [5.5.3 特性文件类别](#553-特性文件类别)
  - [5.5.4 数据色彩空间和PCS](#554-数据色彩空间和pcs)
  - [5.5.5 Flags](#555-flags)
  - [5.5.6 渲染意图（Intent）](#556-渲染意图intent)
  - [5.5.7 PCS标准光源](#557-pcs标准光源)
  - [5.5.8 特性文件创建者（Profile Creator）](#558-特性文件创建者profile-creator)
- [5.6 标签表](#56-标签表)
  - [5.6.1 特性文件描述标签](#561-特性文件描述标签)
  - [5.6.2 XYZ三原色标签](#562-xyz三原色标签)
  - [5.6.3 色调再现曲线标签](#563-色调再现曲线标签)
  - [5.6.4 介质白点标签](#564-介质白点标签)
  - [5.6.5 色彩适应标签](#565-色彩适应标签)
  - [5.6.6 查找表标签](#566-查找表标签)
  - [5.6.7 目标标签（Target Tag）](#567-目标标签target-tag)
  - [5.6.8 色域标签](#568-色域标签)
  - [5.6.9 可选标签](#569-可选标签)
  - [5.6.10 私有标签](#5610-私有标签)
  - [5.7 版本2和版本4特性文件](#57-版本2和版本4特性文件)
  - [5.8 版本5特性文件和iccMAX](#58-版本5特性文件和iccmax)
  - [5.9 查找表是如何工作的？](#59-查找表是如何工作的)
- [5.10 总结](#510-总结)

### 学习目标

* 描述ICC规范和ICC ISO标准。
* 解释ICC特性文件的标签和头部信息。
* 思考日常问题，例如内部特性文件名称和立方体节点。
* 思考v2和v4特性文件的类型。
* 介绍v5 iccMAX特性文件及其架构。
* 通过一个例子，展示查找表是如何工作的。

## 5.1 引言

本章着眼于ICC特性文件（profile），并对其内部结构和运作方式提供技术性解释。虽然要使用一个色彩管理工作流程，可能并不需要达到这种详细程度的知识，但这些知识有助于理解色彩管理是如何运作的。打个比方，您可以在不了解发动机机械原理的情况下驾驶汽车从A点到B点。但是，如果您的车坏了，或者没有按要求运行，您就遇到了问题。在汽车修理或ICC色彩管理中，如果您对流程的基本原理和组成部分有所了解，您就可以做出明智的决定。

一个ICC特性文件是描述成像设备色彩特性的数据文件。可以为扫描仪、数码相机、显示器或打印机创建ICC特性文件。也有一些用于特殊情况的“非设备”特性文件，例如色彩空间特性文件。

一个特性文件的结构受到严格的规管并被遵守，因此来自许多不同供应商的各种软件，以及在工作流程的不同部分（例如图像编辑、处理、互联网准备和打印），都可以使用一个特性文件。是哪家公司制作的特性文件，是哪个程序在使用它，或者是哪个特性文件检查器被用来查看其内容，这些都无关紧要——每个人都可以使用和编辑一个特性文件，因为其严格规管的结构和对ICC文件格式规范的遵守。

特性文件由两部分组成：一个**文件头（header）**和一个**标签（tags）**。文件头包含关于设备类型、CMM等信息。标签形成了特性文件的主体，并包含了设备的工作部分，包括各种查找表。本章描述了在扫描仪、显示器和打印机特性文件中找到的文件头和标签。本章还描述了随着特性文件从v2演进到v4，再到新的iccMAX v5特性文件而发生的一些变化。

**Profile检查器**是可用于查看特性文件内容的特殊软件工具。在本章中，我们使用了两个免费的实用程序——ColorSync实用工具（macOS）和ICC Profile Inspector（Windows）。一个优秀的的商业产品，Chromix ColorThinkPro，也在一些例子中使用。

最后，本章还提供了一个关于查找表如何工作的解释。查找表是色彩管理的基础，因此，我们提供了一个实际的例子来清晰地演示查找表的操作。

## 5.2 ICC特性文件规范

特性文件的格式由国际色彩联盟（ICC）通过一个名为**Specification ICC.1**的*规范*来指定，如图5.1所示。该规范也被提交给适当的国家和国际委员会，以作为国际*标准*发布，即ISO 15076。ICC规范和相应的ISO标准具有相同的内容，见表5.1。

ICC规范可以从ICC网站（www.color.org）免费获得，而ISO标准可以从ISO网站（www.iso.org）购买和下载。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image.png)


![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-1.png)

## 5.3 十六进制特性文件编码

ICC特性文件的内容是二进制数据，使用十六进制表示法显示。我们提供一个关于二进制、十进制和十六进制系统的简要计算机科学回顾。这些数字系统总结如下：

* **二进制** – 只使用两个数字 – 0, 1 – 开或关
* **十进制** – 我们的正常计数系统，使用十个数字 – 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
* **十六进制** – 使用十六个数字 – 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, A, B, C, D, E, F
> 在开发语言中表示：如二进制 int a = 0b0102；八进制int a = 0123；十六进制int a = 0x123A

计算机数据最有效地存储为0或1，即二进制位。十六进制计数系统是2的倍数（$2^4=16$），因此是计算机数据的便捷编码系统。**一个ICC特性文件的全部内容都是用十六进制表示法编码的**。特性文件中的数据以4字节的十六进制数存储，如图5.2所示。以字母“C-o-p-y”为例，它们被存储为十六进制的“43-6F-70-79”。十六进制编码可以通过一个隐藏的键盘快捷键在ColorSync实用工具中看到，在点击一个标签元素之前按住alt/option键。在这里，我们翻译了一个ICC特性文件中的一个元素，读者可以查找每个十六进制数并找到其余内容的ASCII转换。

>这里简单说一下怎么转换的，二进制表示：67 (C) -> 01000011；111 (o) -> 01101111；112 (p) -> 01110000；121 (y) -> 01111001；
>对于 01101111 (o):前4位是 0110 -> 十进制是 6 -> 十六进制是 6; 后4位是 1111 -> 十进制是 15 -> 十六进制规定用 F 来表示15。所以，二进制 01101111 的十六进制写法就是 6F。 其他同理

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-2.png)

十六进制编码对于计算机系统来说很方便，但对于用户来说，要打开并检查一个特性文件的内容并不容易。虽然特性文件检查器软件和程序员级别的工具（如Matlab）可以打开和解析ICC特性文件的内容，但在一般情况下，内部特性文件结构对于普通用户来说仍然基本上是无法访问的。

如果ICC特性文件编码是在今天开发的，可能会使用一种更易于访问的格式，如**XML**来编码特性文件数据。XML被用于许多色彩技术领域，例如Windows色彩系统（WCS）、iccMAX（v5 ICC特性文件架构）和CxF（专色数据文件）。


## 5.4 ICC特性文件的结构

我们来思考一个ICC特性文件的结构，如图5.3a所示。一个ICC特性文件包含一个**文件头（header）**，其后跟着一个**标签表（tag table）**。文件头是特性文件的标准化部分，包含固定数量的项目。标签表包含标签署名，其后是标签内容的偏移量或位置，最后是标签的大小。

ICC为每种类型的特性文件都指定了一个必需的标签列表。因此，**显示器特性文件必须有一个色调再现曲线标签**，而打印机特性文件则需要适当的。没有必需的标签，特性文件就是无效的。由于所有方面都遵守这种格式，特性文件制作软件可以创建有效的特性文件，而应用程序也可以安全地导入和使用特性文件。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-3.png)

## 5.5 特性文件头

文件头是特性文件的标准化部分，由创建该特性文件的程序填写。ICC建议使用所有的文件头字段，以便提供关于一个设备以及该特性文件是如何以及何时被构建的最完整信息。由于文件头信息是标准化的，并且在所有特性文件中都可用，软件应用程序可以依赖它的存在。只要文件头被正确填写，这就为程序打开和使用ICC特性文件提供了一个可靠的方式，而不会导致程序挂起或崩溃。让我们看看一些特性文件头的组成部分，并了解软件应用程序是如何解释和使用它们的。

### 5.5.1 首选CMM

文件头中的字段之一是首选CMM，如图5.4a所示。**CMM**是色彩管理模块（Color management module）的缩写。CMM是一个色彩引擎，负责对图像数据进行色彩转换。当一个图像和特性文件被发送到CMM时，CMM的作用是使用特性文件中的信息，将图像数据从一个色彩空间转换到另一个。CMMs由多家供应商提供，包括Adobe, Agfa, Apple, Canon, EFI, Heidelberg, Kodak, Little CMS, Microsoft等。

特性文件中的CMM名称必须是在ICC注册的注册缩写，并可在www.color.org的ICC注册表中找到。图5.4a显示了首选的CMM，在本例中是“HDM”，这是Heidelberg的注册缩写。

特性文件头中的CMM字段指定了默认要使用的CMM，但在许多软件应用程序中，用户可以覆盖特性文件中的条目。例如，Photoshop允许用户在运行时选择CMM，在图5.4b中，首选CMM被Adobe Color Engine (ACE)覆盖。

其意图是所有CMM的行为或多或少都是相同的，但使用不同CMM获得的结果可能会有一些差异。一些用户可能希望选择他们获得的CMM，以确保Mac和PC用户之间的结果是相同的。例如，Adobe Color Engine在Mac和Windows平台上都可用。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-4.png)

### 5.5.2 规范版本

规范版本字段对应于ICC规范的版本号，旧的特性文件版本号为v2，而新的特性文件应为v4或v5。特性文件制作软件通常会允许用户创建一个v2或v4的特性文件，如图5.5a所示。所选的版本随后会作为规范版本被编码在文件头中，如图5.5b所示。

通常，当为了正确使用一个特性文件而有必要升级色彩管理模块（CMM）时，版本号就会增加。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-5.png)

### 5.5.3 特性文件类别

特性文件头的一个重要部分是类别字段。该类别告诉我们我们拥有的是哪种类型的特性文件，例如数码相机、显示器、打印机等等。有七个特性文件类别：**输入 (scnr)**、**显示 (mntr)**、**输出 (prtr)**、**设备链接 (link)**、**色彩空间 (spac)**、**抽象 (abst)** 和 **命名颜色 (nmcl)**，见表5.2。类别条目之所以重要，是因为它指明了在特性文件的标签表部分期望找到什么样的标签；因此，在打开一个特性文件时，大多数软件会首先查看类别字段。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-6.png)

输入、显示和输出特性文件是基本的、标准的特性文件类型。**设备链接**特性文件是允许直接进行设备到设备转换的特性文件（就是说我不需要再源->PCS->目标, 我只需一个写死的源->目标文件即可）。例如，一个设备链接特性文件可能是CMYK到CMYK的转换。设备链接特性文件由两个连接在一起的特性文件制成。您可以通过将一个图像依次通过两个特性文件处理，或将它们连接在一起，来达到设备链接特性文件的效果。设备链接特性文件提供了一个方便的快捷方式，所以如果您知道您总是想使用两个设备（例如，在一个打样场景中，一台胶印机和一台喷墨打样机），您可以将这两个特性文件组合起来，这减少了操作次数并消除了用户出错的风险。Photoshop 5.6版现在支持设备链接特性文件，大多数RIPs、服务器和其他色彩软件系统也是如此。

**色彩空间**特性文件的例子有“Generic L\*a\*b\* Profile”和“Generic XYZ Profile”。色彩空间特性文件用于将图像数据转换进或出一个设备无关的色彩空间。macOS作为其系统架构的一部分，安装了许多色彩空间特性文件。**抽象**特性文件用于特殊目的——例如，存储图像编辑，如Photoshop对话框中所示。**命名颜色**特性文件用于支持色彩系统，例如用于PANTONE®库的数据。

### 5.5.4 数据色彩空间和PCS

数据色彩空间指的是设备色彩空间，而PCS指的是特性文件连接空间。这些字段指明了该特性文件可以在哪些色彩空间之间进行转换，如图5.7所示。数据色彩空间将是RGB或CMYK，而PCS将是XYZ或L\*a\*b\*。显示器特性文件倾向于基于矩阵变换，并且通常使用XYZ作为PCS，而基于查找表的打印机特性文件通常使用L\*a\*b\*。CMM可以很容易处理色彩空间之间的转换，因此在混合XYZ和L\*a\*b\*特性文件方面没有限制。特性文件通常有能力在两个方向上转换数据；也就是说，从PCS到数据色彩空间，反之亦然。处理数据的方向是根据提交给CMM的特性文件的顺序自动确定的。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-7.png)

对于一个输出特性文件，数据色彩空间可以是CMYK或n色，其中“n”最多可以为16。在广色域印刷中，常见到“6色”的数据色彩空间。请注意，“CMYK”的数据色彩空间和“4色”的并不相同，两者都是4通道的特性文件，但CMYK假定着色剂是C-M-Y-K，而“4色”则不作此假设。

数据色彩空间字段有一些实际用途。像Photoshop这样的软件程序可以使用特性文件头中的数据来排序和显示一个菜单列表，如图5.7所示。Photoshop使用来自数据色彩空间字段的信息，根据它们的颜色空间（例如，RGB，CMYK，或灰度）来列出特性文件。

特性文件头中的数据色彩空间字段也可用于其他目的，例如，色彩管理系统可以将喷墨打印机视为RGB或CMYK设备。图5.8显示了一个用于Epson 4900 CMYK打印机的RGB特性文件。如果您检查颜色空间字段，您会看到在制作该特性文件时，该打印机被视为一个RGB设备。如果您正在使用一个打印机驱动程序来向一台喷墨打印机打印，只会列出RGB打印机特性文件，但如果您正在使用一个RIP，则应选择用于同一台打印机的CMYK特性文件。如果您在下拉菜单中找不到一个特性文件，请打开该特性文件并检查数据色彩空间信息。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-8.png)

### 5.5.5 Flags

一个特性文件头包含一个旗标（Flags）字段。旗标字段的一部分由ICC保留使用，并用于指定诸如特性文件是嵌入在图像中还是独立存在的问题。一个色彩管理系统供应商，例如ColorSync和Apple CMM，可以使用该字段的其余部分。在本章显示的屏幕截图中，我们看到了“Normal Quality”和“Best Quality”的使用。

ColorSync使用旗标字段的供应商部分来进行质量设置。ColorSync单方面决定了对此字段的解释（希望其他供应商会遵守相同的解释）。

让我们看看质量设置是如何工作的。质量设置控制颜色匹配的质量与执行匹配所需的时间之间的关系。有三种质量设置：Normal, Draft, 和 Best。

当您开始一个颜色匹配会话时，ColorSync会将图像和所需的特性文件发送给CMM。Apple CMM从特性文件中提取它需要的查找表，并产生一个新的、单一的查找表。使用单一查找表而不是分离的查找表是色彩处理中一种常见的技术，可以加速运行时应用程序。新的查找表的大小可以被选择，以平衡内存需求、准确性和处理速度。

在当前的实现中，normal和draft设置做的事情相似。当使用这些质量设置时，Apple CMM被指示从发送给CMM的特性文件中制作一个新的查找表。然而，在best-quality设置中，Apple CMM保留了来自特性文件的原始查找表，并且不创建一个合并的查找表。

> 搞成一个新的，意思是将源->PCS-目标 到源->目标

### 5.5.6 渲染意图（Intent）

特性文件头中的一个字段是用于渲染意图。渲染意图可以被设置为感知（0），相对比色（1），饱和度（2），或绝对比色（3）。特性文件检查器可能会显示渲染意图的数值，或者将其翻译成用户友好的短语。

渲染意图字段在今天基本上是多余的，因为在许多情况下，软件应用程序将提供一个菜单可选的渲染意图选择，这将覆盖特性文件头中的渲染意图。例如，在图5.4中，特性文件头中的感知意图被Photoshop用户界面中的相对比色意图覆盖。

### 5.5.7 PCS标准光源

PCS标准光源是参考光源。在特性文件头中，光源是D50，其XYZ值为0.9642, 1.000, 和 0.8249。PCS光源作为一个可更改的项目被包含在内，因为ICC长期以来计划将PCS扩展以包括其他白点。

**请注意，特性文件头中的PCS白点不同于材料/设备的白点。一个特性文件通常包含两个白点——PCS标准光源白点（D50），以及其次，被特性化设备的测量白点。PCS标准光源白点在特性文件头中指定，而显示器或喷墨纸张或印刷条件的白点则在标签表的一个媒体白点标签中指定，见5.6.4节。**

### 5.5.8 特性文件创建者（Profile Creator）

这是一个用户可能经常检查的字段，因为它指明了是用哪个ICC特性文件制作程序来创建的。每个特性文件制作程序都可以用它自己的风格创建一个ICC特性文件，有点像类比，用户可能喜欢尼康或佳能数码相机的再现风格。特性文件制作程序可以创建非常不同的感知渲染意图，不同的黑版生成策略，或不同大小的查找表。不同供应商也可能在标签表中包含不同的标签。

考虑一下GRACoL 2006特性文件。一个版本的GRACoL 2006特性文件是由Monaco Systems创建的，并且可以从ICC Profile Registry获得，如图5.9a所示。该特性文件有提供GRACoL2006_Coated1v2，创建者是“MONS”。我们看到Adobe版本的特性文件有提供CoatedGRACoL2006，创建者是“Adobe”。这些特性文件略有不同，只有通过检查创建者字段，我们才能确定我们正在使用的是哪一个。

创建者字段应遵循ICC制造商签名注册，但该注册并不总是最新的，所以用户必须推断以下常见的创建者；MONS (Monaco Systems), Adbe (Adobe Systems), CvSp (ColorVision Spyder), HP, LOGO (GretagMacbeth), X rit (X-Rite)等。

> 其实就是说明一下这个文件是谁创建的，起个标识作用

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-9.png)


## 5.6 标签表

与文件头相反，标签表中的标签可以根据特性文件所适用的设备类型（数码相机、显示器、打印机等）而变化。ICC为每一类特性文件都指定了一个必需的标签列表。要成为一个有效的特性文件，它必须包含给定设备类别的所有必需标签。

标签可分为三类：ICC必需标签、ICC可选标签和私有标签。

### 5.6.1 特性文件描述标签

每个特性文件都必须包含一个特性文件描述标签——签名为“desc”，如图5.10a所示。该描述标签存储了特性文件的名称。特性文件有一个外部文件名和一个内部名称，如图5.10b所示。一个特性文件的特性文件描述标签最多可以包含该文件的三个不同的内部名称。这些内部名称用于多平台和多语言支持。

一些程序，例如Photoshop，会使用这个内部名称来创建其下拉菜单。如果用户更改了外部文件名但没有更改内部名称，这可能会导致混淆。在桌面上，用户会看到一个带有外部文件名的特性文件，而在Photoshop中，程序会提取内部文件名来创建其下拉菜单中的条目。

确保外部名称与内部名称匹配的一种方法是使用ColorSync实用工具中的修复或编辑功能。一个商业解决方案，Chromix ColorThink Pro，也允许用户协调内部和外部名称，如图5.10b所示。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-10.png)

### 5.6.2 XYZ三原色标签

像显示器这样的设备，可以通过其屏幕三原色的颜色来进行特性化。简单的加色设备，如平板显示器，可以通过一个矩阵，结合色调再现曲线，将RGB值转换为XYZ值，从而被充分地特性化。在显示器特性文件制作过程中，放置在显示器表面的仪器会测量屏幕的红、绿、蓝三原色的色度，并将该信息存储在XYZ三原色标签中，如图5.11所示。屏幕三原色的色度以CIE XYZ坐标的形式存储，标签名称分别为rXYZ, gXYZ, bXYZ。

XYZ三原色标签中的数据被用来形成一个3x3的矩阵，该矩阵可用于处理图像数据，从而执行色彩空间转换。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-11.png)

### 5.6.3 色调再现曲线标签

色调再现曲线（Tone reproduction curve, TRC）数据用于特性化显示器或数码相机。我们希望测量和记录的显示器的主要特性之一是其伽马（对比度）设置，因为这会影响显示图像的外观。特性文件可以存储与显示器伽马相关的信息。在显示器特性文件中，TRC代表了显示器的伽马。
> 有个古老显示器叫CRT（阴极射线管）显示器，别和TRC搞混了 :)
> 需要注意的是现在好多液晶显示器并不满足这个gamma曲线特性了特别是国产显示器。所以一般用3DLUT做特征化

TRC标签中的数据可以以多种方式存储：可以存为一个单一值（图5.12a），一个带有明确曲线点的查找表（图5.12b），或者一个方程式（参数曲线类型）（图5.12c）。通常，对于性能良好的设备，各种编码TRC信息的方法在准确性上预计不会有太大差异。

由于矩阵-TRC结构的构造非常简单——所需要的只是主要着色剂的XYZ值和一个TRC标签——因此您可能会遇到任意数量的自定义RGB特性文件，例如BruceRGB, DonRGB, ProPhoto RGB等。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-12.png)

### 5.6.4 介质白点标签

介质白点标签必须包含在所有特性文件中，它是对介质的测量，例如，纸张测试目标中的白块或显示器的白点。介质白点标签使用CIE XYZ的单位。如果用户能确认打印机测量数据被正确填充为介质白点，那将是令人放心的，如图5.13所示。如果工作流程中出现色彩问题，可以检查此标签中的数据，看在特性文件制作过程中是否发生了任何错误。介质白点标签中的数据被用于多种计算，例如那些涉及绝对比色意图的计算。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-13.png)

### 5.6.5 色彩适应标签

一个ICC工作流程假定测量是在使用D50光源的情况下进行的。如果光源不是D50，那么在创建特性文件及其内容之前，必须使用数学方法将测量的光源（也许是D65）转换为D50。为此，测量数据需要使用数学方法从一个光源适应到另一个光源。有许多已建立的色彩适应方法，例如von Kries变换、Bradford变换或XYZ值的线性缩放。使用每种类型的变换得到的结果是有差异的。如果未指定色彩方法，产品A可能会使用与产品B不同的变换，我们可能会看到不同的结果。这种情况通过在v4特性文件中引入的**色彩适应标签**得到了澄清。

用于转换数据的方法由一个矩阵的内容来指示，并包含在色彩适应标签中，如图5.14所示。源光源下的XYZ值乘以色度适应变换矩阵，以计算出PCS（D50）的XYZ值。如果在测量过程中的照明就是D50，那么特性文件制作软件可以省略应用此标签。然而，为了提高互操作性，建议为特性文件应用包含此标签，即使它包含一个如图所示的空矩阵。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-14.png)

### 5.6.6 查找表标签

查找表标签可以在扫描仪、数码相机、显示器和打印机特性文件中找到。查找表是色彩管理的基础，因为它被用来将像素值从源色彩空间转换到目标色彩空间——我们可以说色彩管理是通过一系列查找表来工作的。例如，像Photoshop这样的程序会使用查找表信息将图像数据从RGB转换为L\*a\*b\*，然后再转换为CMYK。由于查找表操作是色彩管理的核心，并且像素值通过查找表的转换将在5.9节中通过一个实际的例子进行更详细的描述。

显示器、扫描仪和数码相机特性文件是更简单的加色设备，它们的色彩特性通常可以通过前面描述的矩阵-TRC模型得到充分的特性化。因此，显示器和数码相机特性文件只是选择性地包含查找表标签，因为当两种方法都存在时，CMM将始终使用查找表，因为它代表了更高阶、更好的转换。

**对于打印机、打样机或印刷机，油墨颜料的特性、介质的复杂混合以及承印物与油墨的相互作用都需要一个更复杂的模型来描述设备的色彩特性，因此查找表被用于所有输出类型的特性文件中。**

所有打印机特性文件必须包含六个查找表，如表5.3所列。查找表标签的解释是，AToB表示从PCS到设备的查找表，而BToA标签是设备到PCS的查找表。因此，AToB0查找表包含可用于转换图像像素值的数据，例如，从L\*a\*b\*到CMYK，而BToA0查找表可用于将像素数据从CMYK转换到L\*a\*b\*。


对于每种渲染意图，都有不同的查找表。所以特性文件中有用于感知查找表（A2B0和B2A0）、相对比色查找表（A2B1和B2A1）以及饱和度查找表（A2B2和B2A2）的标签。一个特性文件不包含绝对比色渲染意图的数据，相反，如果用户请求根据绝对比色处理图像，则使用来自相对比色查找表的数据，结合媒体白点标签中的信息来计算绝对比色转换。


![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-15.png)

在检查一个特性文件的标签偏移量时，我们看到查找表标签可以有相同的偏移量，如图5.15所示。在这个特性文件中，例如，不同渲染意图的查找表（B2A0, B2A1, 和 B2A2）都使用了相同的标签地址，这意味着相同的数据被用于不同的标签。这种技术被用在那些供应商必须包含多个必需的查找表标签以生成一个有效的ICC特性文件，但供应商尚未为每个标签内容准备不同数据的情况下。重用标签可以在所有特性文件类型中进行，并且是高效的——它减少了文件大小——但最终用户应该意识到，在这种特性文件中选择一个不同的渲染意图，不会对处理后的数据产生任何差异。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-16.png)

一个v2 ICC特性文件中的查找表有一个明确定义的内部格式，如图5.16所示。它由四部分组成：一个矩阵、一组一维查找表、一个多维查找表和另一组一维查找表。图像中的像素值会依次通过这些组件进行处理。查找表的不同部分被用来影响颜色转换的结果。一维查找表可以应用一条曲线来创建线性的RGB值，矩阵可以用来在RGB和XYZ之间执行线性转换，而多维查找表之后的一维曲线可以用来给予中性色更大的权重。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-17.png)

特性文件制作软件没有必要使用查找表标签中的所有元素，实际上它们也确实不这样做。然而，该格式提供了灵活性，以便供应商可以使用他们想要的，并忽略他们不想要的。如果一个供应商不想使用查找表标签的一部分，他们可以用空值填充这部分标签。

查找表是在特性文件制作过程中，由特性文件制作软件创建的。查找表中的分辨率，或称**立方体节点**的数量，可能对颜色转换的质量以及最终输出的颜色产生直接影响。更多的立方体节点可以极大地改善渐变、高光和阴影细节以及颜色再现的许多其他方面的色彩质量。

在实际情况中，用户可能会检查查找表标签中的立方体节点数量，如图5.17所示。在这个例子中，使用Chromix ColorThink Pro软件进行可视化，A2B1查找表（即CMYK到L\*a\*b\*）中的立方体节点数是17个网格点或立方体节点。A2B1表用于打样。B2A1查找表（即L\*a\*b\*到CMYK）有33个立方体节点。B2A1表负责处理最终的图像数据，建议构建此表时使用更多的立方体节点，如此例所示。用户可能希望检查关键特性文件中的立方体节点数量，因为它对色彩质量有直接的影响。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-18.png)


### 5.6.7 目标标签（Target Tag）

特性文件可以包含一个名为“目标靶标标签”（Target tag）的标签，如图5.18所示。此标签包含了测量显示器或测量打印机特性化目标靶标（IT8.7/4或ECI 2002等）时得到的**原始测量数据**。提供此标签的目的是，让分布式应用软件可以识别底层的特性化数据、创建新的色彩转换或根据原始设备测量值检查当前性能。

当一个特性文件的查找表被生成时（以打印机特性文件为例），其黑版生成策略就已经被确定并编码在查找表中。如果要更改黑版生成的级别，就必须从原始测量数据重新生成特性文件。如果这些原始数据存在于“目标靶标标签”中，特性文件制作软件就可以使用这些信息，并为用户提供用新的黑版生成策略重新生成特性文件查找表的选项。

在特性文件中保留原始测量数据是一种有用的“最佳实践”，因此ICC为希望这样做的厂商提供了相应的标签类型。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-19.png)

### 5.6.8 色域标签

色域标签提供关于**超出色域**的颜色的信息，并且是打印机特性文件中的一个必需标签，如图5.19所示。与RGB设备相比，印刷系统的色域通常相对较小，来自数码相机的某些颜色可能因为超出了打印机的色域能力而无法被再现。在处理图像时，如果目标设备无法再现某种颜色，提醒用户是很有用的。输出特性文件中的色域标签指明了哪些像素在色域内或色域外，并可以帮助我们预测设备能够或不能够再现哪些颜色。

图5.19a中展示了GRACoL 2006 ICC特性文件的色域。该图显示了在L\*=50亮度下的a\*b\*平面。在此平面中，色域内的值由零值显示，而色域外的值由非0表示。我们还注意到，该表包含介于0和255之间的数字，因此该系统不是二进制或量化的，对于一个L\*a\*b\*颜色是否在色域内的问题，它可以返回一个限定符。相同的信息可以在三维空间中进行可视化，如图5.19b所示。给定一个L\*a\*b\*值，可以在此查找表中查找，并返回一个“色域内”或“色域外”的响应，该响应可以通过软件以颜色编码或染色图像的方式传达给用户。
> 也就是说色域内用0标识，色域外边缘是0-255之间的，再外面是255表示

不幸的是，很少有应用程序使用色域标签，因为许多特性文件虽然包含色域标签，但并不能产生好的结果。鉴于色域标签是一个必需标签，它没有被充分利用，这是一个遗憾；许多供应商不依赖色域标签中的数据，而是在特性文件内部建立自己的色域边缘限制。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-20.png)
>不过这个图我每太看明白啊，中间不是0吗

### 5.6.9 可选标签

除了必需标签外，还有一些其他被ICC承认和批准的标签。这些被称为可选标签。

包含这些标签，顾名思义，是**可选的**，缺少这些标签不应导致应用程序停止运行或无法打开和使用一个特性文件。供应商可以使用可选标签来改善一个特性文件或系统的性能。可选标签可用于增强色彩转换，或提供PostScript Level 2支持、校准支持、黑点和白点映射等。

可选标签的例子有**亮度标签（lumi）**，可用于以坎德拉/平方米为单位存储显示器的亮度；**测量标签（meas）**，可以存储一个替代的测量规范，例如D65光源而不是默认的D50；以及一个**黑版生成标签（bfd）**。

### 5.6.10 私有标签

ICC允许使用私有标签，供应商可以用它来在一个特性文件中加入专有数据，这通常被称为“**独门秘方**”，如图5.20所示。如果一个供应商在特性文件中有私有标签，而您使用该供应商的色彩处理软件来处理您的图像，您将会获得增强的功能和更好的结果，或者至少供应商会如此声称。

私有标签必须在ICC的私有标签注册表中注册和列出。私有标签允许CMM开发者为他们的色彩管理系统增加专有价值。通过仅注册标签名称，开发者在保持其机密性和专有优势的同时，也保证了与ICC规范的兼容性。

私有标签的使用允许供应商使其产品差异化。然而，由于ICC的总体理念是维护一个开放、跨平台的环境，**私有标签的使用是不被鼓励的**，并且开发者被指示将其使用保持在绝对最低限度。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-21.png)

### 5.7 版本2和版本4特性文件

v2 ICC特性文件格式规范已经使用了多年，并被特性文件制作者和用户广泛接受。对于大多数工作流程，v2特性文件架构和兼容v2的CMM可以毫无问题地工作，但在某些特定情况下，用户从同一个特性文件对的串联中会看到不同的结果。v4特性文件规范中引入了一些更改，最后更新于2010年。这些更改旨在消除规范中的歧义，并偶尔为特性文件构建者和CMM引入新的格式和结构。

偶尔，由于ICC规范的更改，也会出现一些混淆。在早期的ICC规范扫描仪特性文件中，只有一个查找表，称为AToB0标签。在1998年的规范中，为扫描仪特性文件定义了AToB1和AToB2标签，但在最近的ICC规范中，所有查找表都已明确定义，扫描仪特性文件可以包含与所有其他特性文件类型相同的查找表集。

v2和v4特性文件之间的许多其他更改已在本章中描述，包括对色彩适应标签的新要求，以及引入具有更多处理元素的更高级的查找表类型。高级应用程序需要一个更清晰的配置文件连接空间（PCS）定义，v4规范的一个显著特点是引入了**感知参考介质色域（Perceptual Reference Medium Gamut, PRMG）**，它提高了特性文件对之间的互操作性。

在采用v4特性文件时，没有必要拥有一个专属的v4工作流程，v2和v4特性文件可以同时使用。

ICC的理念是关于一致性和可预测性，所以我们看到，从v2到v4特性文件的大部分更改都是ICC为了减少色彩处理过程中的任何歧义来源而做出的努力。

### 5.8 版本5特性文件和iccMAX

第一代ICC架构被称为ICC.1，它定义了v2和v4特性文件。iccMAX是一个具有v5特性文件的**新一代架构**。iccMAX**不打算**作为现有ICC.1架构的替代品，它更多的是一个扩展或替代方案，用于处理现有架构无法完全满足的要求。iccMAX涵盖的领域包括：多光谱系统、医学成像、包装印刷、色彩外观建模、美术、三维渲染和颜色信息存档。总的来说，iccMAX被认为是针对特定颜色工作流程的一个“扩展的”色彩管理系统。

iccMAX的开发与ONYX Graphics的首席科学家Max Derhak密切相关，他同时也是ICC的联合主席。

在iccMAX架构中有许多潜在的改进。特性文件连接空间（PCS）可以从色度（XYZ或L\*a\*b\*）扩展到包含用于反映、透射、发射和双向（荧光）光谱的**光谱PCS**。

iccMAX架构支持各种“特性文件连接”，其中数据可以添加到颜色处理流程中，支持XML文件。特性文件连接的例子可以包括用于叠印可视化的色调数据、用于光源的光谱曲线、用于医疗幻灯片可视化的生物标记物、专色CxF数据等。

虽然iccMAX特性文件的编码仍然是十六进制，但增加了对XML用于信息交换的使用。例如，一个特性文件可以被转换为ICC格式和XML表示之间，如图5.21所示。许多iccMAX数据结构可以被存储、导入和导出为XML编码。这允许特性文件被转换为可以由文本编辑器直接编辑的文本表示，然后再转换回ICC/iccMAX特性文件格式。

iccMAX引入了**互操作性符合性规范（Interoperability Conformance Specification, ICS）**的概念。ICS的概念是，每个实现不一定需要包含所有组件或标签；相反，软件或硬件可以通过读取或写入由特定ICS定义的ICC标签的子集来声明符合性。iccMAX概念定义了一个平台，可以在其上定义多个子集——其中单独的ICS文档可以定义不同的特性文件组件——这与ICC.1方法是一个完全不同的概念，在ICC.1中，单个CMM需要寻求实现所有特性文件组件。

iccMAX作为一项ICC规范（ICC.2）及其自己的标准ISO 20677发布。许多工作流程和规范都基于ICC.1，并将继续使用，无需任何更改——如果现有架构保持不变，行业将受到最小的干扰，iccMAX是当前色彩处理工作流程的延伸。

在本书出版时，iccMAX ICC规范已经发布，而其ISO标准ISO 20677正在通过国际委员会进展中。像所有新兴技术一样，现在预测iccMAX将如何被各种行业接受和采纳还为时过早。随着参考实现的出现，iccMAX的早期采用者可能会找到利用新系统各种优势的方法。其他人可能会等待，直到一个ISO标准被批准或市场需求被证明，然后再投入资源来创建独立的实现。只有时间会告诉我们答案。

### 5.9 查找表是如何工作的？

让我们理解一下打印机特性文件查找表中的数学原理，以便更好地领会色彩管理实际上是如何进行的。我们使用一个特性文件检查器来查看一个查找表的内容。

本节展示的例子使用了旧版的特性文件检查器和旧版的打印机特性文件，然而，这是一个真实的数据和有效的例子，用于阐释查找表的工作原理。（我们使用一个旧版本的特性文件检查器，因为它非常清晰且易于理解。）

在一个成像系统中，来自输入设备（如扫描仪或数码相机）的RGB值被转换到中央连接空间，如图5.22所示。要打印图像，颜色信息会从连接空间转换出来，并使用输出特性文件中的一个查找表，转换为适当的CMYK值。中央连接空间以L\*a\*b\*的形式指定，而设备空间是CMYK。一个输入特性文件包含一个将RGB关联到L\*a\*b\*的查找表，而输出特性文件包含另一个查找表，其中L\*a\*b\*值被转换为适合特定打印机的CMYK值。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-22.png)

查找表是如何工作的？让我们只考虑图5.22中流程的打印部分，即输出特性文件。一个色彩管理系统以L\*a\*b\*形式指定图像中所需的颜色。输出特性文件查找表的作用是将LAB转为设备驱动值（就是CMYK）。这样对于一个给定的L\*a\*b\*值，输出特性文件会告诉我们应该发送什么样的CMYK值给打印机来创建这个颜色。

在ColorSync Profile Inspector（macOS 9）中，分析一个查找表的内容非常容易。macOS X中的ColorSync实用工具对于这个例子来说太令人困惑了！图5.23a显示了一个爱普生Stylus 5000打样机特性文件的B2A1标签的查找表。该表提供了该打印机特性文件的绝对比色意图的L\*a\*b\*-到-CMYK映射。我们可以使用图左侧的三列查找一个L\*a\*b\*值，并在图右侧读取相应的CMYK值。

图5.23a左侧的第一列是L\*值。刻度从0到100 L\*，因此该列大约是50 L\*。接下来的两列是a\*和b\*。这些列上的刻度范围从-128到+128。示例显示了a\*和b\*值为0（即中性色）的选择。所选查找的颜色，其L\*a\*b\*值为50, 0, 0。

![alt text]({{ site.baseurl }}/assets/Understanding Color Management/5profile/image-23.png)

相应的CMYK值显示为图5.23a右侧的四个输出值。在这种情况下，这四个通道指的是CMYK。这里的输出值是从0到65535的范围。所以青色是26134/65535 x 100 ≈ 40%  ($2^{16} -1$)。这个查找表表明，发送给爱普生打印机40%C, 40%M, 37%Y, 0%K的指令，预计会创建一个L\*a\*b\*值约为50, 0, 0的中性灰色。


现在，让我们考虑同一个特性文件查找表，但用于一个不同的打印机，HP Design-jet 20ps，图5.23b。让我们看看这个查找表中L\*a\*b\*值与前一个例子中考虑的值相同的条目。为了再现50, 0, 0的颜色，查找表建议打印机应被发送C45%, M48%, Y44%, 0%K的网点百分比值。每个查找表都包含为特定设备量身定制的指令，这就是特性文件制作过程如何为不同的设备实现相同颜色的方式。
> 这里原文所说的同一个profile LUT应该不太准确吧？应该是说不同的profile的LUT。不然的话同一个profile LUT怎么可能会产生不同的结果呢

在实际的图像处理中，或许传入的像素值L\*a\*b\*值为49,0,0或48,0,0。中间值是使用一种称为**插值**的程序来查找的。中间值是通过查看查找表中的相邻值，以数学方式确定的。我们早先描述了立方体节点数量的影响，现在我们可以看到，更多的立方体节点意味着更多的立方体节点和任何值都会有一个更近的邻居和更好的准确性。

查找表是色彩管理的基础，因为色彩管理的过程实际上就是这样发生的。像Photoshop或一个RIP这样的程序会逐个像素地通过这个查找表来处理一个图像。

## 5.10 总结

本章描述了ICC特性文件是如何根据ICC规范（或等效标准）制作的。当特性文件根据这些文件制作时，它确保了每个人都可以制作一个ICC特性文件，并且每个人都可以轻松地使用一个ICC特性文件。

本章使用了被称为特性文件检查器的工具。这些是简单（且通常免费）的软件工具，允许用户查看一个ICC特性文件的内容。

本章描述了一个ICC特性文件的两个主要部分：文件头和特性文件标签。我们看到文件头有许多固定的字段。文件头的固定性质意味着像Photoshop这样的应用程序可以依赖于找到这些数据，例如，来形成包含特性文件名称的下拉菜单。我们看了可以在特性文件中找到的三种类型的标签：ICC必需标签、ICC可选标签和私有标签。我们看了每个特性文件类别必须存在的必需标签，以构成一个有效的ICC特性文件。我们看到输入、显示和打印机特性文件的标签要求是不同的。

查看特性文件内部为我们提供了一个更强大的位置来优化特性文件制作过程，并且它通常是识别和解决色彩管理工作流程中问题的唯一方法。例如，一个常见的问题是，当用户点击桌面文件图标并更改一个特性文件的外部文件名时。这可能导致该特性文件从Photoshop的菜单中消失。如果您查看特性文件内部，您可以迅速看到问题所在并纠正它。查看特性文件内部的另一个原因是查看查找表中的立方体节点数量。如果您的特性文件没有使用最大允许的节点数，您可能没有得到最好的结果。

ICC的理念是关于一致性和可预测性，所以我们看到，在v4特性文件中引入强制性的色彩适应标签是ICC为减少色彩处理过程中的任何歧义来源而做出的持续努力。还考虑了v2和v4之间的其他差异，例如引入了感知参考介质色域（PRMG），这是一个更清晰的PCS定义。描述了向iccMAX (v5) 特性文件和架构的迁移，包括相关的XML技术的使用。

使用两个不同的喷墨打样机的真实生活例子，展示了如何读取特性文件查找表中的数据。这个例子从根本上演示了查找表是如何工作的，并因此演示了色彩管理中的许多操作是如何进行的。

本章包含了一些参考材料，当我们在实际应用中开始应用和使用ICC特性文件时，读者可能需要回头查阅。